/*
Deployment script for starry

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "starry"
:setvar DefaultFilePrefix "starry"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (OPERATION_MODE = READ_WRITE) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Rename refactoring operation with key e0d5127f-0471-43bb-8080-522db4eb25fa, fea7c746-255c-49d5-9a7b-b21750aed834, 0f0f18e7-0414-4176-8659-f0488d437e7e is skipped, element [dbo].[Room].[Id] (SqlSimpleColumn) will not be renamed to room_id';


GO
PRINT N'Rename refactoring operation with key 11732070-b7ee-4cdd-9ecb-9ae166b56858 is skipped, element [dbo].[People].[Id] (SqlSimpleColumn) will not be renamed to _id';


GO
PRINT N'Rename refactoring operation with key 7d3da06d-de86-4ff1-985c-6f245b27a65b, bda7a60a-fb9d-41d4-ba31-2bf52b5e5e51 is skipped, element [dbo].[Room].[OwnerId] (SqlSimpleColumn) will not be renamed to owner_id';


GO
PRINT N'Rename refactoring operation with key c9170840-d08d-4f09-997e-7450ff825035 is skipped, element [dbo].[RoomDetails].[Id] (SqlSimpleColumn) will not be renamed to _id';


GO
PRINT N'Rename refactoring operation with key f2679b14-8415-433e-8cde-8f82e2ea8708 is skipped, element [dbo].[FK_RoomDetails_ToTable] (SqlForeignKeyConstraint) will not be renamed to [FK_RoomDetails_ToRoom]';


GO
PRINT N'Rename refactoring operation with key 16657888-f6e9-4833-8321-de503b170498 is skipped, element [dbo].[Comments].[Id] (SqlSimpleColumn) will not be renamed to _id';


GO
PRINT N'Rename refactoring operation with key fa33bbc4-7215-4e82-82ea-2625c73a838c is skipped, element [dbo].[PeopleDetails].[Id] (SqlSimpleColumn) will not be renamed to _id';


GO
PRINT N'Rename refactoring operation with key 0c8762ee-5c06-4f94-8dab-d3ae5a3fb1cf is skipped, element [dbo].[People].[Owner_Id] (SqlSimpleColumn) will not be renamed to owner_id';


GO
PRINT N'Rename refactoring operation with key a36f09eb-16e9-44f7-9acf-c16763de8484 is skipped, element [dbo].[People].[Owner_Name] (SqlSimpleColumn) will not be renamed to owner_name';


GO
PRINT N'Rename refactoring operation with key bdc75360-0161-44b7-b705-8164e66a078d is skipped, element [dbo].[People].[Verified] (SqlSimpleColumn) will not be renamed to verified';


GO
PRINT N'Rename refactoring operation with key 0034f855-c215-4ecf-be33-c3eb9752ff69 is skipped, element [dbo].[RoomDetails].[Room_Id] (SqlSimpleColumn) will not be renamed to room_id';


GO
PRINT N'Rename refactoring operation with key 5cee153f-33e4-4dfa-b823-3b3889a73674 is skipped, element [dbo].[RoomDetails].[Online] (SqlSimpleColumn) will not be renamed to online';


GO
PRINT N'Rename refactoring operation with key a8f68820-3110-4674-8a29-84c4f3b8d099 is skipped, element [dbo].[RoomDetails].[Category] (SqlSimpleColumn) will not be renamed to category';


GO
PRINT N'Rename refactoring operation with key 5383c8c8-a647-4c24-9d78-e3f48eb4e628 is skipped, element [dbo].[RoomDetails].[Gift] (SqlSimpleColumn) will not be renamed to gift';


GO
PRINT N'Rename refactoring operation with key c954d6e9-40f8-42f8-b5ee-2fc07b79d7aa is skipped, element [dbo].[Comments].[Room_Id] (SqlSimpleColumn) will not be renamed to room_id';


GO
PRINT N'Rename refactoring operation with key 2c3c68b1-8522-40af-a775-c001df4343c5 is skipped, element [dbo].[Comments].[User_Id] (SqlSimpleColumn) will not be renamed to user_id';


GO
PRINT N'Rename refactoring operation with key 8cb403a1-e44a-4bf2-9081-707e9a106897 is skipped, element [dbo].[Comments].[User_Name] (SqlSimpleColumn) will not be renamed to user_name';


GO
PRINT N'Rename refactoring operation with key 3a6a7d27-486e-4d9e-83e6-51401f1230b5 is skipped, element [dbo].[Comments].[Comments] (SqlSimpleColumn) will not be renamed to comments';


GO
PRINT N'Rename refactoring operation with key 6df9ff8a-87e4-4dac-9d38-e50d7a29886d is skipped, element [dbo].[Comments].[TimeStamp] (SqlSimpleColumn) will not be renamed to timestamp';


GO
PRINT N'Creating [dbo].[Comments]...';


GO
CREATE TABLE [dbo].[Comments] (
    [_id]       INT            IDENTITY (1, 1) NOT NULL,
    [room_id]   INT            NOT NULL,
    [user_id]   INT            NOT NULL,
    [user_name] NVARCHAR (50)  NOT NULL,
    [comments]  NVARCHAR (MAX) NULL,
    [timestamp] DATETIME       NOT NULL,
    PRIMARY KEY CLUSTERED ([_id] ASC)
);


GO
PRINT N'Creating [dbo].[People]...';


GO
CREATE TABLE [dbo].[People] (
    [_id]        INT           IDENTITY (1, 1) NOT NULL,
    [owner_id]   INT           NOT NULL,
    [owner_name] NVARCHAR (50) NOT NULL,
    [verified]   SMALLINT      NOT NULL,
    PRIMARY KEY CLUSTERED ([_id] ASC),
    UNIQUE NONCLUSTERED ([_id] ASC),
    UNIQUE NONCLUSTERED ([owner_id] ASC)
);


GO
PRINT N'Creating [dbo].[PeopleDetails]...';


GO
CREATE TABLE [dbo].[PeopleDetails] (
    [_id]          INT            IDENTITY (1, 1) NOT NULL,
    [weight]       NVARCHAR (50)  NULL,
    [avg_audience] INT            NULL,
    [analysis]     NVARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([_id] ASC)
);


GO
PRINT N'Creating [dbo].[Room]...';


GO
CREATE TABLE [dbo].[Room] (
    [room_id]  INT NOT NULL,
    [owner_id] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([room_id] ASC)
);


GO
PRINT N'Creating [dbo].[RoomDetails]...';


GO
CREATE TABLE [dbo].[RoomDetails] (
    [_id]      INT            NOT NULL,
    [room_id]  INT            NOT NULL,
    [online]   INT            NOT NULL,
    [category] NVARCHAR (50)  NULL,
    [gift]     NVARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([_id] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[People]...';


GO
ALTER TABLE [dbo].[People]
    ADD DEFAULT 0 FOR [verified];


GO
PRINT N'Creating [dbo].[FK_Comments_ToRoom]...';


GO
ALTER TABLE [dbo].[Comments] WITH NOCHECK
    ADD CONSTRAINT [FK_Comments_ToRoom] FOREIGN KEY ([room_id]) REFERENCES [dbo].[Room] ([room_id]);


GO
PRINT N'Creating [dbo].[FK_Room_ToPeople]...';


GO
ALTER TABLE [dbo].[Room] WITH NOCHECK
    ADD CONSTRAINT [FK_Room_ToPeople] FOREIGN KEY ([owner_id]) REFERENCES [dbo].[People] ([owner_id]);


GO
PRINT N'Creating [dbo].[FK_RoomDetails_ToRoom]...';


GO
ALTER TABLE [dbo].[RoomDetails] WITH NOCHECK
    ADD CONSTRAINT [FK_RoomDetails_ToRoom] FOREIGN KEY ([room_id]) REFERENCES [dbo].[Room] ([room_id]);


GO
